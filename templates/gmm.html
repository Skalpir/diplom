{% extends "layout.html" %}
{% block title %}–ê–Ω–∞–ª—ñ–∑ GMM{% endblock %}
{% block content %}

<h2>üß™ –ê–Ω–∞–ª—ñ–∑ GMM</h2>
<p>–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é: —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –º–æ–¥–µ–ª—å –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞—è–≤–Ω—É.</p>

<!-- –í–∏–±—ñ—Ä –¥—ñ—ó -->
<div class="mb-3">
  <label for="gmm-mode" class="form-label">–î—ñ—è</label>
  <select class="form-select" id="gmm-mode" onchange="toggleGMMMode()">
    <option value="new">–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –º–æ–¥–µ–ª—å</option>
    <option value="existing">–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —ñ—Å–Ω—É—é—á—É –º–æ–¥–µ–ª—å</option>
  </select>
</div>

<!-- üîß –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –º–æ–¥–µ–ª—ñ -->
<div id="new-gmm-section">
  <form id="gmm-form" method="POST" action="/run_gmm" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="n_components" class="form-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤</label>
      <input type="number" class="form-control" id="n_components" name="n_components" value="3" min="1">
    </div>

    <div class="mb-3">
      <label for="max_iter" class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —ñ—Ç–µ—Ä–∞—Ü—ñ–π</label>
      <input type="number" class="form-control" id="max_iter" name="max_iter" value="100" min="1">
    </div>

    <div class="mb-3">
      <label for="covariance_type" class="form-label">–¢–∏–ø –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—ó</label>
      <select class="form-select" id="covariance_type" name="covariance_type">
        <option value="full" selected>full</option>
        <option value="tied">tied</option>
        <option value="diag">diag</option>
        <option value="spherical">spherical</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="gmm_impl" class="form-label">–í–∏–±—ñ—Ä —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó GMM</label>
      <select class="form-select" id="gmm_impl" name="gmm_impl">
        <option value="my-gmm">my-gmm</option>
        <option value="sklearn-gmm">sklearn-gmm</option>
      </select>
    </div>

    <!-- üîÑ –í–∞–ª—ñ–¥/—Ç—Ä–µ–π–Ω/—Ç–µ—Å—Ç —Ä–æ–∑–ø–æ–¥—ñ–ª -->
    <div class="mb-3">
      <label class="form-label">–†–æ–∑–ø–æ–¥—ñ–ª –¥–∞–Ω–∏—Ö</label>
      <div class="input-group">
        <span class="input-group-text">–¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω—ñ %</span>
        <input type="number" class="form-control" name="train_pct" value="70" min="0" max="100">
        <span class="input-group-text">–í–∞–ª—ñ–¥–∞—Ü—ñ—è %</span>
        <input type="number" class="form-control" name="val_pct" value="15" min="0" max="100">
        <span class="input-group-text">–¢–µ—Å—Ç %</span>
        <input type="number" class="form-control" name="test_pct" value="15" min="0" max="100">
      </div>
    </div>

    <div class="mb-3">
      <label for="file" class="form-label">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV-—Ñ–∞–π–ª (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)</label>
      <input class="form-control" type="file" id="file" name="file" accept=".csv">
    </div>

    <input type="hidden" name="selected_file" id="selected_file">
    <button type="submit" class="btn btn-success">üîÅ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ GMM</button>
  </form>

  <div id="loading" style="display: none;" class="mt-3 alert alert-info">
    üîÑ –ê–Ω–∞–ª—ñ–∑ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è... –ó–∞—á–µ–∫–∞–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞.
  </div>
</div>

<!-- üìÅ –†–æ–±–æ—Ç–∞ –∑ –Ω–∞—è–≤–Ω–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ -->
<div id="existing-gmm-section" style="display: none;">
  <h4>üì¶ –Ü—Å–Ω—É—é—á—ñ –º–æ–¥–µ–ª—ñ</h4>

  {% if models %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>–ù–∞–∑–≤–∞ –º–æ–¥–µ–ª—ñ</th>
        <th>–î–∞—Ç–∞</th>
        <th>–î—ñ—ó</th>
      </tr>
    </thead>
    <tbody>
      {% for model in models %}
      <tr>
        <td>{{ model.name }}</td>
        <td>{{ model.mtime }}</td>
        <td>
          <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥—ñ–π –∑ –º–æ–¥–µ–ª–ª—é , –±–µ–∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Ñ–ª–∞—Å–∫—É-->
          <button class="btn btn-primary btn-sm" disabled>üìà –ó—Ä–æ–±–∏—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑</button>
          <button class="btn btn-warning btn-sm" disabled>üîÅ –î–æ–Ω–∞–≤—á–∞–Ω–Ω—è</button>
          <button class="btn btn-secondary btn-sm" disabled>‚¨Ü –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–æ–¥–µ–ª—å</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="alert alert-info">–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π —É <code>/results</code>.</div>
  {% endif %}

  <div class="mb-3 mt-4">
    <label class="form-label">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–≤–æ—é –º–æ–¥–µ–ª—å (.json)</label>
    <input type="file" class="form-control" accept=".json">
  </div>
</div>

<hr>

<h4>üìÇ –û–±–µ—Ä—ñ—Ç—å CSV-—Ñ–∞–π–ª —ñ–∑ <code>uploads</code>:</h4>
<table class="table table-striped">
  <thead>
    <tr>
      <th>–§–∞–π–ª</th>
      <th>–î–∞—Ç–∞</th>
      <th>–†–æ–∑–º—ñ—Ä</th>
      <th>–î—ñ—è</th>
    </tr>
  </thead>
  <tbody>
    {% for file in files[:10] %}
    <tr>
      <td>{{ file.name }}</td>
      <td>{{ file.mtime }}</td>
      <td>{{ file.size }}</td>
      <td>
        <button type="button" class="btn btn-outline-primary btn-sm" onclick="selectFile('{{ file.name }}')">–í–∏–±—Ä–∞—Ç–∏</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<a href="{{ url_for('results') }}" class="btn btn-outline-secondary">üìä –ü–µ—Ä–µ–π—Ç–∏ –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</a>

<!-- JS –ª–æ–≥—ñ–∫–∞ -->
<script>
  function toggleGMMMode() {
    const mode = document.getElementById("gmm-mode").value;
    document.getElementById("new-gmm-section").style.display = (mode === "new") ? "block" : "none";
    document.getElementById("existing-gmm-section").style.display = (mode === "existing") ? "block" : "none";
  }

  function selectFile(filename) {
    document.getElementById('selected_file').value = filename;
    alert("–§–∞–π–ª " + filename + " –≤–∏–±—Ä–∞–Ω–æ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É");
  }

  document.getElementById('gmm-form').addEventListener('submit', function () {
    document.getElementById('loading').style.display = 'block';
  });
</script>

{% endblock %}
